# tg-gemini-bot

[English](README_EN.md) | [繁體中文](README.md)

**tg-gemini-bot** 是一個極速、基於規則的 Telegram 助手。最初是為 Google Gemini 設計的，現在已重構為高效能的規則引擎，能夠立即回應常見任務，無需大型語言模型 (LLM) 的延遲或成本。

## 🚀 進階功能概覽

此機器人已透過強大的規則函數進行重大升級，可對各種任務提供即時回應。

### 🌍 地震資訊服務

整合台灣中央氣象署 (CWA) 和美國地質調查局 (USGS) 的即時地震資訊：

**即時地震資訊：**
- `/eq_latest` - 最新顯著地震報告（含地震報告圖片）
- `/eq_alert` - CWA 地震速報與預警
- `/eq_significant` - CWA 過去 7 天顯著有感地震列表

**全球地震監控：**
- `/eq_global` - 全球近 24 小時顯著地震（規模 5.0 以上）
- `/eq_taiwan` - 台灣區域今年顯著地震列表
- `/eq_map` - 外部地震查詢服務連結

**AI 智慧助理：**
- `/eq_ai <問題>` - 使用 AI 查詢地震資料
  - 範例：`/eq_ai 昨天花蓮有地震嗎？`
  - 範例：`/eq_ai 2024年4月規模6以上的地震有哪些？`
  - AI 可以自動呼叫地震資料庫工具並提供智慧分析

**資料來源：**
- 台灣中央氣象署開放資料平台
- 美國地質調查局 (USGS) 地震 API
- Google Gemini 1.5 Flash (AI 功能)

### 📰 新聞服務

透過 RSS 訂閱源獲取即時新聞資訊：

**新聞指令：**
- `/news` - 從多個來源獲取一般新聞
- `/news_tech` - 科技新聞（Hacker News）
- `/news_taiwan` - 台灣新聞（中央社）
- `/news_global` - 全球新聞（BBC）

**功能特點：**
- 即時 RSS 訂閱源
- 多來源新聞聚合
- 自動格式化顯示
- 包含新聞標題、時間和連結

**資料來源：**
- Hacker News - 科技新聞
- 中央社 (CNA) - 台灣新聞
- BBC News - 全球新聞

### 🧮 進階數學功能

機器人現在可以處理複雜的數學表達式與科學函數：

- **基本運算**：`(12 + 8) * 5`、`100 / 4`、`2^10`
- **科學函數**：
  - `sqrt(144)` - 平方根
  - `sin(45)` - 正弦（以度為單位）
  - `cos(60)` - 餘弦（以度為單位）
  - `tan(30)` - 正切（以度為單位）
  - `log(100)` - 以 10 為底的對數
  - `ln(2.718)` - 自然對數
  - `exp(2)` - 指數函數
  - `abs(-15)` - 絕對值
  - `factorial(5)` - 階乘
- **小數支援**：`10.5 / 2.1`
- **安全性**：使用沙盒化的 `eval`，無法存取內建函數

### 🔄 單位轉換系統

即時轉換各種單位：

**距離轉換：**
- `10 km to miles` → 6.21 英里
- `5 miles to km` → 8.05 公里
- `100 meters to feet` → 328.08 英尺
- `50 feet to meters` → 15.24 公尺

**重量轉換：**
- `5 kg to lbs` → 11.02 磅
- `150 lbs to kg` → 68.04 公斤

**溫度轉換：**
- `32 F to C` → 0°C
- `100 C to F` → 212°F

### 🌤️ 增強的天氣資訊

透過位置感知功能獲取詳細的天氣資訊：

- **當前天氣**：「現在的天氣如何？」或「巴黎的天氣」
- **明天的預報**：「明天天氣如何」
- **每週預報**：「本週天氣」或「7 天預報」
- **特定條件**：「會下雨嗎？」、「溫度是多少？」、「今天的濕度」
- **風力資訊**：「風速是多少？」

**功能特點：**
- 攝氏和華氏溫度
- 濕度和體感溫度
- 風速和風向
- 紫外線指數和能見度
- 從查詢中檢測位置

### 📅 進階時間與日期功能

具有計算功能的全面時間和日期能力：

**當前資訊：**
- `現在幾點？` - 帶時區的當前時間
- `今天是幾號？` - 完整日期資訊
- `今天星期幾？` - 星期幾

**日期計算：**
- `7 天後` → 顯示 7 天後的日期
- `30 天前` → 顯示 30 天前的日期
- `明天是幾號？`
- `昨天是幾號？`

**時區支援：**
- `UTC+8 的時間` - 顯示指定時區的時間
- `時區 UTC-5` - 東部時區

**詳細資訊：**
- 年度的週數
- 年度的天數
- 月份和年份資訊

### 🌍 語言檢測

各種文字的簡單語言模式檢測：

**支援的語言：**
- 中文（中文）
- 俄文（Русский）
- 日文（日本語）
- 韓文（한국어）
- 阿拉伯文（العربية）
- 泰文（ไทย）
- 以及更多！

### 👋 多語言問候

具有時段智慧的語境感知問候：

**支援的問候語言：**
- 英語：Hi、Hello、Hey
- 西班牙語：Hola
- 法語：Bonjour
- 義大利語：Ciao
- 德語：Hallo
- 葡萄牙語：Olá
- 俄語：Привет
- 中文：你好
- 日語：こんにちは
- 韓語：안녕하세요

**智慧回應：**
- 基於時間的問候（早上、下午、晚上）
- 告別檢測（bye、goodbye、see you）
- 感謝識別（多種語言）

## 🎯 主要功能

- **⚡ 閃電般的速度**：使用本地規則邏輯立即生成回應
- **🔒 隱私優先**：不向外部 AI 供應商發送數據
- **🎨 豐富的功能**：7+ 個進階規則函數
- **🌐 多語言**：支援多種語言
- **📊 智慧檢測**：智慧回應的模式匹配
- **🛠️ 基於 Flask**：輕量級且易於擴展
- **☁️ 支援 Vercel**：只需點擊一下即可部署到 Vercel
- **🐳 支援 Docker**：容器化設計，便於在任何地方部署

## 準備工作

準備好這些內容，然後將其作為環境變量填寫在 Vercel 或您的 Docker 環境中。

- **BOT_TOKEN** (必填)

  透過 [@BotFather](https://t.me/BotFather) 建立您自己的 Telegram 機器人並獲取 Token。

- **GOOGLE_API_KEY** (可選 - 啟用 AI 功能)

  啟用 Gemini API 功能呼叫能力。從 [Google AI Studio](https://makersuite.google.com/app/apikey) 取得您的 API 金鑰。
  - 沒有此金鑰：機器人使用快速規則模式
  - 有此金鑰：機器人使用智慧 Gemini 功能呼叫

- **CWA_API_KEY** (可選 - 地震服務)

  台灣中央氣象署 API 金鑰，用於存取顯著地震資料。
  - 從 [CWA 開放資料平台](https://opendata.cwa.gov.tw/) 取得您的 API 金鑰
  - `/eq_significant` 和 `/eq_latest` 指令需要此金鑰
  - 地震預警和全球資料無需此金鑰即可運作

- **MCP_SERVER_URL** (可選 - AI 地震搜尋)

  MCP 伺服器 URL，用於透過 AI 進行進階地震資料庫搜尋。
  - 預設值：`https://cwadayi-mcp-2.hf.space`
  - 僅 `/eq_ai` 指令查詢歷史地震時需要

- **ALLOWED_USERS / ALLOWED_GROUPS** (可選)

  限制特定用戶或群組的存取。

## 開始使用

1. **部署到 Vercel**：點擊按鈕進行克隆和部署。
2. **設置環境變量**：配置您的 `BOT_TOKEN`。
3. **連接 Webhook**：訪問 `https://api.telegram.org/bot<bot-token>/setWebhook?url=<vercel-domain>` 以連接您的機器人。

## 環境變量

| 變量 | 必填 | 描述 |
| --- | --- | --- |
| BOT_TOKEN | 是 | 您的 Telegram 機器人 Token。 |
| ALLOWED_USERS | 否 | 允許的用戶名或 ID（支援正則表達式）。 |
| ALLOWED_GROUPS | 否 | 允許的群組 ID 或用戶名。 |
| ADMIN_ID | 否 | 用於管理員指令的 Telegram ID。 |
| IS_DEBUG_MODE | 否 | 設置為 `1` 以啟用調試指令。 |
| AUCH_ENABLE | 否 | 設置為 `0` 以禁用身份驗證。 |

## 指令列表

- `/help` - 顯示所有功能和使用指南
- `/new` - 開始新的互動
- `/get_my_info` - 獲取您的 Telegram ID
- `/get_group_info` - 獲取群組 ID（在群組中）
- `/5g_test` - 運行模擬速度測試

## 💡 使用範例

### 數學計算
```
用戶：「What is sqrt(144)?」
機器人：「The result of sqrt(144) is 12.」

用戶：「Calculate sin(45)」
機器人：「The result of sin(45) is 0.707107.」
```

### 單位轉換
```
用戶：「Convert 10 km to miles」
機器人：「10 km is equal to 6.21 miles.」

用戶：「32 F to C」
機器人：「32 °F is equal to 0 °C.」
```

### 日期計算
```
用戶：「7 days from now」
機器人：「7 days from now will be: Thursday, February 13, 2026」
```

## 🔧 技術架構

### 規則函數優先級

機器人透過優先鏈處理訊息：

1. **function0_help** - 幫助和能力概覽
2. **function1_math** - 進階數學計算
3. **function6_unit_conversion** - 單位轉換
4. **function2_weather** - 天氣資訊
5. **function3_time** - 時間和日期查詢
6. **function7_language_detection** - 語言檢測
7. **function4_greeting** - 問候和禮貌用語
8. **function5_fallback** - 帶建議的有用回退

## 🔐 安全功能

- **沙盒評估**：數學表達式在受限環境中評估
- **無外部 API 呼叫**：所有處理都在本地完成
- **身份驗證支援**：可選的用戶/群組限制
- **注重隱私**：無數據記錄或外部傳輸

## 📄 授權

詳見 [LICENSE.txt](LICENSE.txt)

---

**用 ❤️ 製作，為快速、高效且注重隱私的機器人互動**
